<Window x:Class="AplicacionDespacho.Modules.Trazabilidad.Profiles.Testeador.Views.TesteadorWindow"      
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"      
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"      
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"      
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"    
        xmlns:local="clr-namespace:AplicacionDespacho.Modules.Trazabilidad.Profiles.Testeador.Views"    
        mc:Ignorable="d"      
        Title="Trazabilidad - Testeador de Pallets" Height="700" Width="1000"      
        WindowStartupLocation="CenterScreen">

    <!-- RECURSOS DE LA VENTANA -->
    <Window.Resources>
        <local:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <local:CountToVisibilityConverter x:Key="CountToVisibilityConverter"/>
        <local:InverseCountToVisibilityConverter x:Key="InverseCountToVisibilityConverter"/>
        <local:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <local:BoolToFontWeightConverter x:Key="BoolToFontWeightConverter"/>
    </Window.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Título -->
        <TextBlock Grid.Row="0" Text="Módulo de Testing - Consulta y Eliminación de Pallets"       
                   FontSize="20" FontWeight="Bold" Margin="0,0,0,20"/>

        <!-- Panel de búsqueda -->
        <GroupBox Grid.Row="1" Header="Buscar Pallet" Margin="0,0,0,10">
            <StackPanel Orientation="Horizontal" Margin="10">
                <Label Content="Número de Pallet:" VerticalAlignment="Center"/>
                <TextBox x:Name="txtNumeroPallet" Width="200" Margin="10,0"       
                         Text="{Binding NumeroPallet, UpdateSourceTrigger=PropertyChanged}"/>
                <Button Content="Buscar" Width="100" Height="30"       
                        Command="{Binding BuscarPalletCommand}"/>
                <Button Content="Limpiar" Width="100" Height="30" Margin="10,0,0,0"      
                        Click="BtnLimpiar_Click"/>
            </StackPanel>
        </GroupBox>

        <!-- Información del pallet -->
        <GroupBox Grid.Row="2" Header="Información del Pallet" Margin="0,0,0,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Panel de información - visible cuando hay datos -->
                <StackPanel Grid.Row="0" Margin="10"   
                           Visibility="{Binding Lotes.Count, Converter={StaticResource CountToVisibilityConverter}}">

                    <!-- Información básica del pallet -->
                    <TextBlock Text="{Binding PalletInfo}"   
                              TextWrapping="Wrap"  
                              FontSize="14"  
                              Margin="0,0,0,10"/>

                    <!-- Estado de validación -->
                    <TextBlock Text="{Binding EstadoValidacion}"  
                              FontSize="14"  
                              FontWeight="Bold"  
                              Foreground="{Binding ColorValidacion}"  
                              Margin="0,0,0,10"/>
                </StackPanel>

                <!-- DataGrid de lotes/cuarteles -->
                <DataGrid Grid.Row="1" ItemsSource="{Binding Lotes}"         
                          AutoGenerateColumns="False" IsReadOnly="True"        
                          Margin="10"    
                          Visibility="{Binding Lotes.Count, Converter={StaticResource CountToVisibilityConverter}}">    
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Cuartel" Binding="{Binding CodigoCuartel}" Width="100"/>
                        <DataGridTextColumn Header="CSG Predio" Binding="{Binding CSGPredio}" Width="150"/>
                        <DataGridTextColumn Header="Predio" Binding="{Binding NombrePredio}" Width="200"/>
                        <DataGridTextColumn Header="Productor" Binding="{Binding NombreProductor}" Width="200"/>

                        <!-- ⭐ NUEVAS COLUMNAS AGREGADAS -->
                        <DataGridTextColumn Header="Embalaje" Binding="{Binding EmbalajeCaja}" Width="100"/>
                        <DataGridTextColumn Header="Variedad" Binding="{Binding VariedadCaja}" Width="150"/>
                        <DataGridTextColumn Header="Calibre" Binding="{Binding CalibreCaja}" Width="100"/>

                        <DataGridTextColumn Header="Cajas" Binding="{Binding CantidadCajas}" Width="80"/>
                    </DataGrid.Columns>
                </DataGrid>

                <!-- Mensaje cuando no hay pallet seleccionado -->
                <TextBlock Grid.Row="1" Text="No hay pallet seleccionado. Use el campo de búsqueda arriba."      
                           HorizontalAlignment="Center" VerticalAlignment="Center"      
                           FontSize="14" Foreground="Gray">
                    <TextBlock.Visibility>
                        <Binding Path="Lotes.Count" Converter="{StaticResource InverseCountToVisibilityConverter}"/>
                    </TextBlock.Visibility>
                </TextBlock>
            </Grid>
        </GroupBox>

        <!-- Botones de acción -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Eliminar Pallet" Width="150" Height="35"       
                    Command="{Binding EliminarPalletCommand}"      
                    Background="#D32F2F" Foreground="White" FontWeight="Bold"      
                    Margin="0,0,10,0"/>
            <Button Content="Cerrar" Width="100" Height="35" Click="BtnCerrar_Click"/>
        </StackPanel>
    </Grid>
</Window>
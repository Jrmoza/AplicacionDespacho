<!-- ReporteConsolidadoWindow.xaml -->
<Window x:Class="AplicacionDespacho.ReporteConsolidadoWindow"        
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"        
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"        
        Title="Reporte Consolidado de Pallets" Height="700" Width="1400"        
        WindowStartupLocation="CenterScreen">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Título -->
        <TextBlock Grid.Row="0" Text="Reporte Consolidado de Pallets Enviados"       
                   FontSize="18" FontWeight="Bold"       
                   HorizontalAlignment="Center" Margin="0,0,0,20"/>

        <!-- Información del período -->
        <GroupBox Grid.Row="1" Header="Período del Reporte" Margin="0,0,0,20">
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <Label Grid.Column="0" Content="Desde:" FontWeight="Bold"/>
                <TextBlock Grid.Column="1" x:Name="txtFechaDesde" Margin="5,0,20,0"/>

                <Label Grid.Column="2" Content="Hasta:" FontWeight="Bold"/>
                <TextBlock Grid.Column="3" x:Name="txtFechaHasta" Margin="5,0,20,0"/>

                <Label Grid.Column="4" Content="Total Pallets:" FontWeight="Bold"/>
                <TextBlock Grid.Column="5" x:Name="txtTotalPallets" Margin="5,0,0,0" FontWeight="Bold"/>
            </Grid>
        </GroupBox>

        <!-- Pallets consolidados -->
        <GroupBox Grid.Row="2" Header="Detalle de Pallets Enviados" Margin="0,0,0,20">
            <DataGrid x:Name="dgPallets"       
                      AutoGenerateColumns="False"       
                      IsReadOnly="True"      
                      GridLinesVisibility="Horizontal"      
                      AlternatingRowBackground="LightGray"  
                      CanUserSortColumns="True">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Fecha Envío" Binding="{Binding FechaEnvio, StringFormat=dd/MM/yyyy}" Width="100"/>
                    <DataGridTextColumn Header="N° Viaje" Binding="{Binding NumeroViaje}" Width="80"/>
                    <DataGridTextColumn Header="N° Guía" Binding="{Binding NumeroGuia}" Width="100"/>
                    <DataGridTextColumn Header="Responsable" Binding="{Binding Responsable}" Width="120"/>
                    <DataGridTextColumn Header="Pallet" Binding="{Binding NumeroPallet}" Width="120"/>
                    <DataGridTextColumn Header="Variedad" Binding="{Binding VariedadParaReporte}" Width="140"/>
                    <DataGridTextColumn Header="Calibre" Binding="{Binding Calibre}" Width="80"/>
                    <DataGridTextColumn Header="Embalaje" Binding="{Binding Embalaje}" Width="120"/>
                    <DataGridTextColumn Header="N° Cajas" Binding="{Binding TotalCajasDisplay}" Width="120"/>
                    <DataGridTextColumn Header="Peso Total (kg)" Binding="{Binding PesoTotal, StringFormat=F3}" Width="100"/>
                    <DataGridTextColumn Header="Empresa" Binding="{Binding NombreEmpresa}" Width="150"/>
                    <DataGridTextColumn Header="Conductor" Binding="{Binding NombreConductor}" Width="150"/>
                    <DataGridTextColumn Header="Placa" Binding="{Binding PlacaVehiculo}" Width="100"/>
                    <DataGridTextColumn Header="Origen" Binding="{Binding PuntoPartida}" Width="120"/>
                    <DataGridTextColumn Header="Destino" Binding="{Binding PuntoLlegada}" Width="120"/>
                    <DataGridCheckBoxColumn Header="Modificado" Binding="{Binding Modificado}" Width="80"/>
                </DataGrid.Columns>
            </DataGrid>
        </GroupBox>

        <!-- Resumen de totales -->
        <GroupBox Grid.Row="3" Header="Resumen Consolidado" Margin="0,0,0,20">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Resumen por variedad -->
                <GroupBox Grid.Row="0" Grid.Column="0" Header="Resumen por Variedad" Margin="0,0,10,10">
                    <DataGrid x:Name="dgResumenVariedad"   
                              AutoGenerateColumns="False"   
                              IsReadOnly="True"  
                              MaxHeight="150">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Variedad" Binding="{Binding Variedad}" Width="140"/>
                            <DataGridTextColumn Header="Pallets" Binding="{Binding TotalPallets}" Width="80"/>
                            <DataGridTextColumn Header="Cajas" Binding="{Binding TotalCajas}" Width="80"/>
                            <DataGridTextColumn Header="Kilos" Binding="{Binding TotalKilos, StringFormat=F3}" Width="100"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>

                <!-- Resumen por empresa -->
                <GroupBox Grid.Row="0" Grid.Column="1" Header="Resumen por Empresa" Margin="10,0,0,10">
                    <DataGrid x:Name="dgResumenEmpresa"   
                              AutoGenerateColumns="False"   
                              IsReadOnly="True"  
                              MaxHeight="150">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Empresa" Binding="{Binding Empresa}" Width="150"/>
                            <DataGridTextColumn Header="Pallets" Binding="{Binding TotalPallets}" Width="80"/>
                            <DataGridTextColumn Header="Cajas" Binding="{Binding TotalCajas}" Width="80"/>
                            <DataGridTextColumn Header="Kilos" Binding="{Binding TotalKilos, StringFormat=F3}" Width="100"/>
                            <DataGridTextColumn Header="Viajes" Binding="{Binding CantidadViajes}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </GroupBox>

                <!-- Totales generales -->
                <Border Grid.Row="1" Grid.ColumnSpan="2" BorderBrush="Black" BorderThickness="2"   
                        Background="LightGray" Margin="0,10,0,0">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="10">
                        <!-- Contadores PC/PH simples (siempre visibles) -->
                        <TextBlock Text="PC: " FontWeight="Bold" FontSize="12" Foreground="Green"/>
                        <TextBlock x:Name="txtTotalPC" FontWeight="Bold" FontSize="12" Foreground="Green" Margin="0,0,20,0"/>
                        <TextBlock Text="PH: " FontWeight="Bold" FontSize="12" Foreground="Orange"/>
                        <TextBlock x:Name="txtTotalPH" FontWeight="Bold" FontSize="12" Foreground="Orange" Margin="0,0,30,0"/>

                        <!-- Panel condicional para CT/EN (inicialmente oculto) -->
                        <StackPanel x:Name="panelCTEN" Orientation="Horizontal" Visibility="Collapsed" Margin="0,0,30,0">
                            <TextBlock Text="CT: " FontWeight="Bold" FontSize="12" Foreground="Blue"/>
                            <TextBlock x:Name="txtTotalCT" FontWeight="Bold" FontSize="12" Foreground="Blue" Margin="0,0,20,0"/>
                            <TextBlock Text="EN: " FontWeight="Bold" FontSize="12" Foreground="Purple"/>
                            <TextBlock x:Name="txtTotalEN" FontWeight="Bold" FontSize="12" Foreground="Purple" Margin="0,0,20,0"/>
                        </StackPanel>

                        <!-- Totales generales existentes -->
                        <TextBlock Text="TOTALES GENERALES - Pallets: " FontWeight="Bold" FontSize="14"/>
                        <TextBlock x:Name="txtTotalPalletsGeneral" FontWeight="Bold" FontSize="14" Margin="0,0,30,0"/>
                        <TextBlock Text="Cajas: " FontWeight="Bold" FontSize="14"/>
                        <TextBlock x:Name="txtTotalCajasGeneral" FontWeight="Bold" FontSize="14" Margin="0,0,30,0"/>
                        <TextBlock Text="Kilos: " FontWeight="Bold" FontSize="14"/>
                        <TextBlock x:Name="txtTotalKilosGeneral" FontWeight="Bold" FontSize="14"/>
                    </StackPanel>

                </Border>
            </Grid>
        </GroupBox>

        <!-- Botones -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button x:Name="btnExportar" Content="Exportar Excel" Width="120" Height="30"     
                    Margin="0,0,10,0" Click="btnExportar_Click"/>
            <Button x:Name="btnImprimir" Content="Imprimir" Width="80" Height="30"     
                    Margin="0,0,10,0" Click="btnImprimir_Click"/>
            <Button x:Name="btnCerrar" Content="Cerrar" Width="80" Height="30"     
                    Click="btnCerrar_Click"/>
        </StackPanel>
    </Grid>
</Window>
